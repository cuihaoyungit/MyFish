var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function a(t){try{h(n.next(t))}catch(e){o(e)}}function r(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(a,r)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){h.label=i[1];break}if(6===i[0]&&h.label<a[1]){h.label=a[1],a=i;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(i);break}a[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{s=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,a,r,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},base;!function(t){var e=function(){function t(){}return t.getInstance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this;if(!i._instance){var n=t.length;0==n?i._instance=new i:1==n?i._instance=new i(t[0]):2==n?i._instance=new i(t[0],t[1]):3==n?i._instance=new i(t[0],t[1],t[2]):4==n?i._instance=new i(t[0],t[1],t[2],t[3]):5==n&&(i._instance=new i(t[0],t[1],t[2],t[3],t[4]))}return i._instance},t}();t.baseclass=e,__reflect(e.prototype,"base.baseclass")}(base||(base={}));var gamewidget;!function(t){var e=function(){function t(){}return t.prototype.killTimer=function(){this.timer&&egret.clearInterval(this.timer),this.timer=null},t.prototype.createTimer=function(){var t=this;if(!this.timer){var e=5e3,i=2e3;this.timer=egret.setInterval(function(){if(t.lastTime){var n=(new Date).getTime();n-t.lastTime>e&&n-t.lastTime<=e+i||n-t.lastTime>e+i&&t.killTimer()}},this,1e3)}},t.prototype.destory=function(){},t.prototype.setLastTime=function(t){this.lastTime=t},t}();t.ConnectTimer=e,__reflect(e.prototype,"gamewidget.ConnectTimer")}(gamewidget||(gamewidget={}));var Main=function(t){function e(){var e=t.call(this)||this;return e._pauseTime=30,e.bgChangeTime=BG_CHANG_TIME,e.bgMoveTime=BG_MOVE_TIME,e.isPlaySound=!0,e.gameSound=gamewidget.SoundModule.getInstance(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=this;this.loadSound(),egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause(),e.bgView.isPause(!0)},egret.lifecycle.onResume=function(){egret.ticker.resume(),e.bgView.isPause(!1)},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.loadSound=function(){var t=this._sound=new egret.Sound;t.load("/resource/assets/games/fish/sound/change_sence.mp3")},e.prototype.soundplay=function(){this._channel=this._sound.play(this._pauseTime,1),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this)},e.prototype.soundstop=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this),this._channel.stop(),this._channel=null)},e.prototype.onComplete=function(t){this.soundstop()},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("loading",0,null)];case 2:return i.sent(),t=new LoadingUI,this.stage.addChild(t),t.show(this.stage,1),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.createGameScene=function(){this.logutil=new gamewidget.LogUtils,this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,gamewidget.Toast.init(this.stage,RES.getRes("toast_bg_png")),this.bgView=new gamewidget.BgView,this.bgView.width=this.stageW,this.bgView.height=this.stageH,this.bgView.initUI(this.stageW,this.stageH),this.addChild(this.bgView),this.bgView.touchEnabled=!0,this.bgView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shot,this),this.server=new gamewidget.ServerModel,this.server.init(),egret.log("初始化游戏界面"),this.gunview=new gamewidget.GunView(this,this.stageW,this.stageH),this.gunview.initUI(this.server),this.addChildAt(this.gunview,4),this.autoplay=new gamewidget.AutoPlay,this.stage.addChild(this.autoplay),this.autoplay.x=this.stageW-this.autoplay.width-10,this.autoplay.y=this.stageH-this.autoplay.height-13,this.autoplay.touchEnabled=!0,this.autoplay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAutoPlayClick,this),this.autoplay.status("off");var t=this.createBitmapByName("buy_png");t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyClick,this),t.x=this.stageW-t.width-150,t.y=this.stageH-t.height,t.scaleX=.9,t.scaleY=.9,this.addChild(t),this.soundSwitch=new gamewidget.SoundSwitch,this.stage.addChild(this.soundSwitch),this.soundSwitch.x=30,this.soundSwitch.y=30,this.soundSwitch.touchEnabled=!0,this.soundSwitch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSoundSwitch,this),this.soundSwitch.status("on")},e.prototype.shot=function(t){this.gunview.tapStart(t)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.onAutoPlayClick=function(t){this.gameSound.playSound({name:"button"});var e=t.currentTarget;e.isCheck?(e.status("on"),this.gunview.startAutoPlay()):(e.status("off"),this.gunview.stopAutoPlay())},e.prototype.onBuyClick=function(t){this.gameSound.playSound({name:"button"}),gamewidget.NativeModel.nativeBridge.callHandler("j2n_PayButton",{data:""},function(t){egret.log("j2n_PayButton")})},e.prototype.onSoundSwitch=function(t){this.gameSound.playSound({name:"button"});var e=t.currentTarget;e.isCheck?(e.status("on"),this.isPlaySound=!0,this.gameSound.turnSound(!0)):(e.status("off"),this.isPlaySound=!1,this.gameSound.turnSound(!1))},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var GUN_BASE={x:342,y:378},START_POINT={x:375,y:470},BG_CHANG_TIME=3e3,BG_MOVE_TIME=3e3,IS_AUTO_SHOOT=!1,base;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initGame=function(t){this.gameStage=t},e.prototype.exitGame=function(){},e.isDebug=!1,e}(t.baseclass);t.GameApp=e,__reflect(e.prototype,"base.GameApp")}(base||(base={}));var NativeEvent=function(t){function e(e){var i=t.call(this,e)||this;return i.strdata="",i}return __extends(e,t),e.NATIVE="NATIVEEVENT",e}(egret.Event);__reflect(NativeEvent.prototype,"NativeEvent");var SocketEvent=function(t){function e(e){var i=t.call(this,e)||this;return i.strjson="",i}return __extends(e,t),e.SOCKET="SOCKETEVENT",e}(egret.Event);__reflect(SocketEvent.prototype,"SocketEvent");var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.isCheck=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.create()},e.prototype.create=function(){this.btOn=new egret.Bitmap,this.btOn.texture=RES.getRes("deposit_on_png"),this.btOn.x=0,this.btOn.y=0,this.addChild(this.btOn),this.btOff=new egret.Bitmap,this.btOff.texture=RES.getRes("deposit_off_png"),this.btOff.x=0,this.btOff.y=0,this.addChild(this.btOff),this.btOff.visible=!1},e.prototype.status=function(t){"on"==t?(this.btOn.visible=!0,this.btOff.visible=!1):"off"==t&&(this.btOn.visible=!1,this.btOff.visible=!0),this.isCheck=!this.isCheck},e}(egret.Sprite);t.AutoPlay=e,__reflect(e.prototype,"gamewidget.AutoPlay")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(e){function i(){var n=e.call(this)||this;return n.gameSound=t.SoundModule.getInstance(),n.scores=[5,10,20,100,200],n.vIndex=0,i.value=n.scores[n.vIndex],n}return __extends(i,e),i.prototype.initUI=function(){this.socreBg=new egret.Bitmap,this.socreBg.texture=RES.getRes("gun_num_bg_png"),this.socreBg.x=35,this.socreBg.y=10,this.addChild(this.socreBg),this.socreA=new egret.Bitmap,this.socreA.texture=RES.getRes("score_-_png"),this.socreA.x=0,this.socreA.y=0,this.socreA.touchEnabled=!0,this.addChild(this.socreA),this.socreB=new egret.Bitmap,this.socreB.texture=RES.getRes("score_+_png"),this.socreB.x=130,this.socreB.y=0,this.socreB.touchEnabled=!0,this.addChild(this.socreB),this.socreA.addEventListener(egret.TouchEvent.TOUCH_TAP,this.subScore,this),this.socreB.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addScore,this),this.socre=new egret.BitmapText,this.socre.font=RES.getRes("gun_num_fnt"),this.socre.text=i.value+"",this.socre.x=this.socreBg.x,this.socre.y=this.socreBg.y,this.socre.height=this.socreBg.height,this.socre.width=this.socreBg.width,this.socre.verticalAlign=egret.VerticalAlign.MIDDLE,this.socre.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.socre)},i.prototype.addScore=function(t){t.preventDefault(),this.gameSound.playSound({name:"button"}),this.socreA.touchEnabled=!0,this.vIndex<this.scores.length-1&&(this.vIndex++,i.value=this.scores[this.vIndex],this.socre.text=i.value+""),this.vIndex==this.scores.length-1&&(this.socreB.touchEnabled=!1)},i.prototype.subScore=function(t){t.preventDefault(),this.gameSound.playSound({name:"button"}),this.socreB.touchEnabled=!0,this.vIndex>0&&(this.vIndex--,i.value=this.scores[this.vIndex],this.socre.text=i.value+""),0==this.vIndex&&(this.socreA.touchEnabled=!1)},i.prototype.close=function(t){},i.prototype.destroy=function(){this.socre.font=null,this.socreBg.texture=null,this.socre=null,this.socreBg=null,this.scores=null},i}(egret.Sprite);t.BetScore=e,__reflect(e.prototype,"gamewidget.BetScore")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.bgIndex=1,i.changeTime=2,i.Pause=!1,i.gameSound=t.SoundModule.getInstance(),i.startChange(),i}return __extends(i,e),i.prototype.initUI=function(t,e){this.stageW=t,this.stageH=e,this.backgroundA=new egret.Bitmap,this.backgroundA.texture=RES.getRes("background"+this.bgIndex+"_png"),this.backgroundA.width=t,this.backgroundA.height=e,this.addChildAt(this.backgroundA,0),this.bob=new egret.Bitmap,this.bob.texture=RES.getRes("bob_png"),this.bob.height=e,this.bob.x=t-25,this.backgroundB=new egret.Bitmap,this.backgroundB.texture=RES.getRes("background"+(this.bgIndex+1)+"_png"),this.backgroundB.width=t,this.backgroundB.height=e,this.backgroundB.x=t,this.bgImageContainer=new egret.DisplayObjectContainer,this.addChild(this.bgImageContainer),this.bgImageContainer.width=t,this.bgImageContainer.height=e},i.prototype.isPause=function(t){this.Pause=t},i.prototype.startChange=function(){var t=this;egret.setInterval(function(){t.changeSence()},this,12e4)},i.prototype.changeSence=function(){var t=this;this.gameSound.playSound({name:"change_sence"});for(var e=this.bgImageContainer.numChildren,i=0;e>i;i++)this.bgImageContainer.removeChildAt(0);this.bgImageContainer.addChild(this.backgroundB),this.bgImageContainer.addChild(this.bob),egret.Tween.get(this.backgroundA).to({x:-1*this.backgroundA.width},3e3),egret.Tween.get(this.backgroundB).to({x:0},3e3),egret.Tween.get(this.bob).to({x:-25},3e3).to({x:-200},500).call(function(){t.backgroundA.texture=t.backgroundB.texture,t.backgroundA.x=0,t.backgroundB.x=t.backgroundA.width,t.bob.x=t.backgroundB.x-25,t.bgIndex=4==t.bgIndex?1:t.bgIndex+1;var e=4==t.bgIndex?1:t.bgIndex+1;t.backgroundB.texture=RES.getRes("background"+e+"_png")})},i}(egret.Sprite);t.BgView=e,__reflect(e.prototype,"gamewidget.BgView")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(e){function i(t,i,n,s){var o=e.call(this,t)||this;return o.textureName=i,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o}return __extends(i,e),i.produce=function(e,i,n){null==t.Bullet.cacheDict[e]&&(t.Bullet.cacheDict[e]=[]);var s,o=t.Bullet.cacheDict[e];return o.length>0&&(s=o.pop()),s=new t.Bullet(RES.getRes(e),e,i,n)},i.reclaim=function(e){var i=e.textureName;null==t.Bullet.cacheDict[i]&&(t.Bullet.cacheDict[i]=[]);var n=t.Bullet.cacheDict[i];-1==n.indexOf(e)&&n.push(e)},i.cacheDict={},i}(egret.Bitmap);t.Bullet=e,__reflect(e.prototype,"gamewidget.Bullet")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.caiPan=new egret.Bitmap,this.caiPan.texture=RES.getRes("pan_png"),this.addChild(this.caiPan),this.tag=new egret.Bitmap,this.tag.texture=RES.getRes("tag_png"),this.tag.y=.6*this.caiPan.height,this.tag.x=(this.caiPan.width-this.tag.width)/2,this.bean=new egret.BitmapText,this.bean.font=RES.getRes("pan_num_fnt"),this.bean.y=this.tag.y+8,this.bean.height=40,this.bean.width=180,this.bean.x=(this.caiPan.width-this.bean.width)/2,this.bean.verticalAlign=egret.VerticalAlign.MIDDLE,this.bean.textAlign=egret.HorizontalAlign.CENTER},e.prototype.open=function(t,e){var i=this;this.addChild(this.tag);var n=e.value+"";this.bean.text=n,this.addChild(this.bean),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=e.x,e.x+this.width/2>e.w?this.x=e.x-this.width/2:e.x-this.width/2<0&&(this.x=e.x+this.width/2),this.y=e.y,this.alpha=.1,egret.Tween.get(this).to({alpha:1},200).wait(800).to({alpha:.1},200).call(function(){t.removeChild(i)})},e.prototype.close=function(t){this.removeChild(this.tag),this.removeChild(this.bean)},e.prototype.destroy=function(){this.caiPan=null,this.tag=null,this.caiPan.texture=null,this.tag.texture=null,this.bean.font=null,this.bean=null},e}(egret.Sprite);t.CaiPan=e,__reflect(e.prototype,"gamewidget.CaiPan")}(gamewidget||(gamewidget={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.loading=new egret.DisplayObjectContainer,e.loadingNum=new egret.TextField,e.loadingBg=new egret.Bitmap,e.loadingBar=new egret.Bitmap,e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.backgroundImg=new egret.Bitmap,this.backgroundImg.texture=RES.getRes("loading_bg_png"),this.loadingBg.texture=RES.getRes("loadingBg_png"),this.loadingBar.texture=RES.getRes("loadingBar_png"),this.loadingNum.text="0%",this.loadingMask=new egret.Rectangle(0,0,0,this.loadingBar.height),this.loadingBar.mask=this.loadingMask,this.loadingNum.y=-60,this.loadingNum.x=(this.loadingBg.width-this.loadingNum.width)/2,this.loading.addChild(this.loadingBg),this.loading.addChild(this.loadingBar),this.loading.addChild(this.loadingNum)},e.prototype.onProgress=function(t,e){this.loadingNum.text=Math.floor(t/e*100)+"%",this.loadingMask=new egret.Rectangle(0,0,t/e*this.loadingBar.width,this.loadingBar.height),this.loadingBar.mask=this.loadingMask,100==t&&this.hide()},e.prototype.show=function(t,e){t.addChild(this.backgroundImg),t.addChild(this.loading);var i=e||1;this.backgroundImg.width=t.stageWidth,this.backgroundImg.height=t.stageHeight,this.loading.scaleX=i,this.loading.scaleY=i,this.loading.x=(t.stageWidth-this.loadingBg.width*i)/2,this.loading.y=.75*this.backgroundImg.height},e.prototype.hide=function(){this.loading.parent&&(this.loading.parent.removeChild(this.backgroundImg),this.loading.parent.removeChild(this.loading))},e.prototype.destory=function(){this.loadingBg.texture=null,this.loadingBar.texture=null,this.backgroundImg.texture=null,this.backgroundImg=null,this.loadingBg=null,this.loadingBar=null,this.loadingNum=null,this.loadingMask=null,this.loading=null},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var gamewidget;!function(t){var e=function(e){function i(t,i){var n=e.call(this)||this;switch(n.addChild(t),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,i){case 3:n.scaleX=1.8,n.scaleY=1.8;break;case 2:n.scaleX=1.7,n.scaleY=1.7;case 6:n.scaleX=1.2,n.scaleY=1.2}return t.x=(n.width-t.width)/2,t.y=(n.height-t.height)/2,n}return __extends(i,e),i.produce=function(e){var i,n=RES.getRes("fish_m_"+e+"_json"),s=RES.getRes("fish_m_"+e+"_png"),o=new egret.MovieClipDataFactory(n,s),a=new egret.MovieClip(o.generateMovieClipData("fish_m_"+e));return a.gotoAndPlay(0,-1),i=new t.Fish(a,e)},i.reclaim=function(t){},i.prototype.getcount=function(){return this.count},i.prototype.setCount=function(t){this.count=t},i.prototype.setType=function(t){this.type=t},i.prototype.getType=function(){return this.type},i.cacheDict={},i.mcFactory={},i}(egret.Sprite);t.Fish=e,__reflect(e.prototype,"gamewidget.Fish")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showTheBean=function(t,e,i,n){var s=this,o=1.6;this.x=i,this.y=n,this.bean_m_value=new egret.BitmapText,this.bean_m_value.scaleX=this.bean_m_value.scaleY=.7*o,this.bean_m_value.font=RES.getRes("win_num_fnt"),this.bean_m_value.text="+"+e,this.bean_m_value.x=0,this.bean_m_value.y=0,this.addChildAt(this.bean_m_value,this.numChildren-1);var a=this.bean_m_value.y=0;egret.Tween.get(this.bean_m_value).to({y:a-30},1e3).call(function(){s.removeChild(s.bean_m_value),t.removeChild(s)})},e}(egret.Sprite);t.FishNumberView=e,__reflect(e.prototype,"gamewidget.FishNumberView")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}var i=function(){function t(){}return t.hitTest=function(t,e){var i=t.getBounds(),n=e.getBounds();return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,i.intersects(n)},t}();t.GameUtil=i,__reflect(i.prototype,"gamewidget.GameUtil"),t.createBitmapByName=e}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.onAddToStage=function(t){this.create()},e.prototype.setGold=function(t){this.gold=t,this.money.text=""+t},e.prototype.getGold=function(){return this.gold},e.prototype.delGold=function(t,e){this.gold=this.gold-t,this.money.text=""+this.gold,e.nativieModel.updateMoney(this.gold)},e.prototype.create=function(){var t=this.width,e=.8*this.height;this.$getWidth()/2-t/2,this.$getHeight()/2-e/2;this.anchorOffsetX=this.$getWidth()/2,this.anchorOffsetY=this.$getHeight()/2,this.scaleX=1.3,this.scaleY=1.3;var i=new egret.Bitmap;i=this.createBitmapByName("bean_bg_png"),this.addChild(i),this.money=new egret.BitmapText,this.addChild(this.money),this.money.touchEnabled=!1,this.money.font=RES.getRes("win_num_fnt"),this.money.text="0",this.money.scaleX=this.money.scaleY=.8,this.money.y=i.height/4,this.money.x=i.width/5},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);t.GoldPay=e,__reflect(e.prototype,"gamewidget.GoldPay")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(e){function i(i,n,s){var o=e.call(this)||this;return o.isProduceFish=!0,o.autoInt=[],o.gameSound=t.SoundModule.getInstance(),o.gameApp=base.GameApp.getInstance(),o.fishs=[],o.fishcount=0,o.parent=i,o.stageW=n,o.stageH=s,o.startFishPos=s/7,o.initNative(),o}return __extends(i,e),i.prototype.initUI=function(e){this.base=new egret.Bitmap,this.base.texture=RES.getRes("gun_base_png"),this.addChild(this.base),this.gun=new egret.Bitmap,this.gun.texture=RES.getRes("gun_png"),this.addChild(this.gun),this.shot=new egret.Bitmap,this.shot.texture=RES.getRes("shot_png"),this.addChild(this.shot),this.betScore=new t.BetScore,this.betScore.initUI(),this.addChild(this.betScore),this.open(this.parent,this.stage),this.goldPay=new t.GoldPay,this.addChildAt(this.goldPay,this.numChildren-1),this.goldPay.x=10,this.goldPay.y=this.stageH-80,this.winnum=new t.NumberView(this.stageH),this.addChildAt(this.winnum,this.numChildren-1),this.netview=new t.NetView,this.server=e,this.server.addEventListener(SocketEvent.SOCKET,this.getSocketDate,this)},i.prototype.open=function(t,e){this.width=this.stageW,this.height=this.stageH;var i=1;this.base.x=543,this.base.y=this.height-this.base.height*i,this.betScore.x=543,this.betScore.y=this.height-this.base.height*i;var n=this.gun.width/2,s=this.gun.height/2+20;this.gun.anchorOffsetX=n,this.gun.anchorOffsetY=s,this.gun.x=552+n,this.gun.y=this.height-this.gun.height*i+s+15,this.shot.anchorOffsetX=this.shot.width/2,this.shot.anchorOffsetY=this.shot.height/2,this.base.scaleX=this.base.scaleY=i,this.gun.scaleX=this.gun.scaleY=i,this.shot.scaleX=this.shot.scaleY=i,this.shot.alpha=0,this.space=Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2)),this.lastAngle=0,this.gunReady()},i.prototype.stopAutoPlay=function(){IS_AUTO_SHOOT=!1,this.stopAutoShoot()},i.prototype.startAutoPlay=function(){IS_AUTO_SHOOT=!0,this.autoInt.length>0&&this.stopAutoShoot(),this.startAutoShoot()},i.prototype.stopAutoShoot=function(){this.autoInt.forEach(function(t){egret.clearInterval(t)})},i.prototype.startAutoShoot=function(){var t=this,e=egret.setInterval(function(){t.shootTheBullet(t.lastTargetX,t.lastTargetY)},this,300);this.autoInt.unshift(e)},i.prototype.produceFish=function(e,i,n){var s=this;this.fishcount++;var o=this.transType(n)[0],a=this.transType(n)[1],r=t.Fish.produce(o);r.setCount(this.fishcount),r.setType(n),0==i?(r.x=0-r.width,r.y=this.startFishPos*e,r.skewY=180,this.addChildAt(r,10),this.fishs.push(r),egret.Tween.get(r).to({x:this.stageW+r.width,y:this.startFishPos*e},1e3*a,egret.Ease.sineIn).call(function(){s.fishs.splice(s.fishs.indexOf(r),1),s.removeChild(r)})):1==i&&(r.x=this.stageW+r.width,r.y=this.startFishPos*e,this.addChildAt(r,10),this.fishs.push(r),egret.Tween.get(r).to({x:0-r.width,y:this.startFishPos*e},1e3*a,egret.Ease.sineIn).call(function(){s.fishs.splice(s.fishs.indexOf(r),1),s.removeChild(r)}))},i.prototype.gameHitTest=function(e,i){var n,s;for(this.pfishcount=this.fishs.length,n=0;n<this.pfishcount;n++)if(s=this.fishs[n],s.$hitTest(e.x,e.y)){this.killBullet(e,i),this.netview.open(e.x,e.y,this),this.gameSound.playSound({name:"hit_fish_sound"});var o={};o.fishNo=s.getType(),o.bulletnum=t.BetScore.value,o.hashcode=s.hashCode;var a=parseInt(s.x.toFixed(0)),r=parseInt(s.y.toFixed(0));o.x=a,o.y=r,this.server.catchFish(o);break}},i.prototype.tapStart=function(t){if(!IS_AUTO_SHOOT&&this.shootTime){var e=(new Date).getTime();if(e-this.shootTime<50)return}this.shootTime=(new Date).getTime(),this.tapTheGun(t),this.gunReady(),IS_AUTO_SHOOT||this.shootTheBullet(this.lastTargetX,this.lastTargetY)},i.prototype.tapTheGun=function(t){var e=t.stageX,i=t.stageY;this.turnTheGun(e,i)},i.prototype.turnTheGun=function(t,e){var i,n=t-this.gun.x,s=e-this.gun.y;s>=0?i=0==s&&0==n?0:0>n?-75:75:(i=360*Math.atan(s/n)/(2*Math.PI),i=i>0?-1*(90-i):90+i,i=i>75?75:i,i=-75>i?-75:i),this.lastAngle=this.gun.rotation=i},i.prototype.gunReady=function(){this.getBulletPos(),this.getShootTargetXY()},i.prototype.getBulletPos=function(){var t=this.lastAngle,e=Math.abs(t)*(2*Math.PI)/360,i=115,n=Math.sin(e)*i,s=Math.cos(e)*i;this.lastBulletX=t>0?this.gun.x+n:this.gun.x-n,this.lastBulletY=this.gun.y-s},i.prototype.setBulletPos=function(t){this.shot.x=t.x=this.lastBulletX,this.shot.y=t.y=this.lastBulletY,t.rotation=this.shot.rotation=this.lastAngle,this.shot.alpha=1},i.prototype.getShootTargetXY=function(){var t=this.lastAngle,e=Math.abs(t)*(2*Math.PI)/360,i=Math.sin(e)*this.space,n=Math.cos(e)*this.space;this.lastTargetX=t>0?this.gun.x+i:this.gun.x-i,this.lastTargetY=this.gun.y-n},i.prototype.shootTheBullet=function(e,i){var n=t.Bullet.produce("bullet_png",0,0);this.setBulletPos(n),this.parent.addChildAt(n,6),this.gameSound.playSound({name:"gun_shot"}),this.fireNow(e,i,n)},i.prototype.fireNow=function(t,e,i){var n=this,s=egret.setInterval(function(){n.touchEdge(i,n.width,n.height,s),n.gameHitTest(i,s)},this,100);this.fire(t,e,i)},i.prototype.fire=function(t,e,i){egret.Tween.get(i).to({x:t,y:e},this.space/1e3*1e3),egret.Tween.get(this.shot).wait(200).to({alpha:0},500)},i.prototype.catchTheFish=function(t,e,i,n){},i.prototype.touchEdge=function(t,e,i,n){t.x<0?this.bounceBack(1,t,e,i,n):t.y<0?this.bounceBack(2,t,e,i,n):t.x>e?this.bounceBack(3,t,e,i,n):t.y>i&&this.bounceBack(4,t,e,i,n)},i.prototype.bounceBack=function(t,e,i,n,s){var o=0,a=1;egret.Tween.removeTweens(e);var r=e.x,h=e.y,g=2*Math.PI/360,c=e.rotation;if(1==t){var u=(0-r)*Math.tan(Math.abs((Math.abs(c)-90)*g));e.y=c>-90?h-u:h+u,e.x=0;var l=e.rotation=Math.abs(c);l=l>90?180-l:l;var d=Math.abs(l)*(2*Math.PI)/360,p=Math.sin(d)*this.space,f=Math.cos(d)*this.space;o=e.x+p,a=e.rotation<=90?e.y-f:e.y+f}else if(2==t){var m=(0-h)*Math.tan(Math.abs(c)*g);e.x=c>0?r-m:r+m,e.y=0;var l=e.rotation=c>0?c+2*(90-c):c-2*(90-Math.abs(c));l=180-Math.abs(l);var d=Math.abs(l)*g,p=Math.sin(d)*this.space,f=Math.cos(d)*this.space;o=e.rotation>0?e.x+p:e.x-p,a=e.y+f}else if(3==t){var u=(r-i)*Math.tan(Math.abs(c-90)*g);e.y=c>90?h-u:h+u,e.x=i;var l=e.rotation=-1*c;l=l>=-90?Math.abs(l):180-Math.abs(l);var d=l*g,p=Math.sin(d)*this.space,f=Math.cos(d)*this.space;o=e.x-p,a=e.rotation>=-90?e.y-f:e.y+f}else if(4==t){var m=(h-n)*Math.tan((180-Math.abs(c))*g);e.x=c>0?r-m:r+m,e.y=n;var l=e.rotation=c>0?c-2*(c-90):c+2*(Math.abs(c)-90),d=Math.abs(l)*(2*Math.PI)/360,p=Math.sin(d)*this.space,f=Math.cos(d)*this.space;o=l>0?e.x+p:e.x-p,a=e.y-f}egret.Tween.get(e).to({x:o,y:a},this.space/1e3*1e3)},i.prototype.killBullet=function(t,e){egret.Tween.removeTweens(t),this.parent.removeChild(t),egret.clearInterval(e)},i.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},i.prototype.transType=function(t){switch(t){case 1:return[4,12];case 2:return[8,12];case 3:return[9,13];case 4:return[10,15];case 5:return[7,18];case 6:return[5,18];case 7:return[11,18];case 8:return[1,18];case 9:return[12,25];case 10:return[6,35];case 11:return[2,35];case 12:return[3,40]}},i.prototype.getSocketDate=function(e){var i=JSON.parse(e.strjson);switch(i.Msg){case t.ServerModel.LOGIN_SERVER:this.goldPay.setGold(i._gold);break;case t.ServerModel.PRODUCE_FISH:if(this.isProduceFish){for(var n=1;5>=n;n++){var s=i["seaway"+n+"left"];s>0&&this.produceFish(n,0,s)}for(var o=1;5>=o;o++){var s=i["seaway"+o+"right"];s>0&&this.produceFish(o,1,s)}}break;case t.ServerModel.CATCH_FISHS:var a=i.re;if(egret.log("re="+a),0==a){this.goldPay.delGold(t.BetScore.value,this.server);var r=i.catch_gold;if(r>0){var h=(i.warncontent,i.userId,i.fishNo,i._gold),g=(i.score,i.target_after_IncomeGold,i.hashcode),c=i.x,u=i.y,l=void 0;if(this.winnum.showTheBean(r),500>r){var d=new t.FishNumberView;d.showTheBean(this,r,c,u),this.addChildAt(d,this.numChildren-1),this.gameSound.playSound({name:"get_bean"})}else{var p=new t.CaiPan;p.open(this,{x:c,y:u,value:r}),this.addChildAt(p,this.numChildren-1),this.gameSound.playSound({name:"big_bean"})}this.goldPay.setGold(h),this.server.nativieModel.updateMoney(h),this.pfishcount=this.fishs.length;for(var f=0;f<this.pfishcount;f++)l=this.fishs[f],l.hashCode==g&&(egret.Tween.removeTweens(l),this.removeChild(l),this.fishs.splice(this.fishs.indexOf(l),1),this.pfishcount--)}}else t.Toast.launch(i.warncontent);break;case t.ServerModel.CHANGE_STATE:var m=i._gold,v=i.type;1==v&&this.goldPay.setGold(m)}},i.prototype.isPhone=function(){var t=(navigator.userAgent.toLowerCase(),egret.Capabilities.os),e="Windows PC"==t,i="Mac OS"==t;return egret.log(t),e||i?!0:!1},i.prototype.initNative=function(){var t=this,e=this.isPhone();setupWebViewJavascriptBridge(function(i){i.registerHandler("n2j_EnterExitGameRoom",function(i,n){"string"==typeof i&&("0"==i?(t.server.nativieModel.updateMoney(t.goldPay.getGold()),t.server.switchState(0,t.goldPay.getGold(),e),t.stopAutoPlay(),t.parent.autoplay.status("off")):(i=i.split("#"),"1"==i[0]?(egret.log("1"),t.goldPay.setGold(i[1]),t.server.switchState(1,t.goldPay.getGold(),e)):"0"==i[0]&&(t.server.nativieModel.updateMoney(t.goldPay.getGold()),t.server.switchState(0,t.goldPay.getGold(),e),t.stopAutoPlay(),t.parent.autoplay.status("off"),t.goldPay.setGold(i[1])))),n&&n(i)}),i.registerHandler("n2j_EnterExitLiveRoom",function(e,i){t.server.nativieModel.updateMoney(t.goldPay.getGold()),t.server.requireCloseSocket(),t.server.exitGame({}),i&&i(e)})})},i}(egret.Sprite);t.GunView=e,__reflect(e.prototype,"gamewidget.GunView")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showlog=function(t){egret.log(t)},e}(egret.Sprite);t.LogUtils=e,__reflect(e.prototype,"gamewidget.LogUtils")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.gameApp=base.GameApp.getInstance(),e.myUser=user.UserModel.getInstance(),e.nativeevent=new NativeEvent(NativeEvent.NATIVE),e}return __extends(e,t),e.prototype.init=function(){var t=this;return base.GameApp.isDebug?void(base.GameApp.isDebug&&egret.log("TEST_MODLE ")):void(base.GameApp.isDebug||setupWebViewJavascriptBridge(function(i){e.nativeBridge=i,i.registerHandler("n2j_StartGame",function(e,i){t.mobiStartGame(e),i&&i(e)}),i.registerHandler("n2j_EnterExitLiveRoom",function(e,i){t.mobiEnterExitLiveRoom(e),i&&i(e)}),i.registerHandler("n2j_EnterExitApp",function(e,i){t.mobiEnterExitApp(e),i&&i(e)}),i.registerHandler("n2j_EnterExitGameRoom",function(e,i){egret.log("EnterExit1551"),t.mobiEnterExitGameRoom(e),i&&i(e)}),i.registerHandler("n2j_UpdateBeanValue",function(t,e){e&&e(t)}),i.callHandler("j2n_LoadReady",{data:""},function(t){egret.log("j2n_LoadReady")})}))},e.prototype.mobiEndGame=function(){base.GameApp.isDebug||e.nativeBridge.callHandler("j2n_EndGame",{data:""},function(t){console.log("JS received response:",t)})},e.prototype.mobiEnterExitApp=function(t){},e.prototype.mobiEnterExitLiveRoom=function(t){"0"==t&&(this.gameApp.gameServer.requireCloseSocket(),this.gameApp.gameServer.exitGame({}),egret.log("向服务器发送断线请求"))},e.prototype.mobiEnterExitGameRoom=function(t){egret.log("EnterExit"+t),"string"==typeof t&&("0"==t?this.gameApp.gameServer.requireCloseSocket():this.gameApp.gameServer.reConnectToServer())},e.prototype.mobiStartGame=function(t){egret.log("从手机获得数据"+t),this.nativeevent.strdata=t+"",this.dispatchEvent(this.nativeevent)},e.prototype.payButton=function(){base.GameApp.isDebug||e.nativeBridge.callHandler("j2n_PayButton",{},function(t){egret.log("JS received response:",t)})},e.prototype.hitGoldEggSuccess=function(t){base.GameApp.isDebug||e.nativeBridge.callHandler("j2n_HitGoldEggSuccess",{gift_id:t.gift_id,bagNum:t.bagNum,gold:t.gold},function(t){egret.log("JS received response:",t)
})},e.prototype.updateScore=function(t){base.GameApp.isDebug||e.nativeBridge.callHandler("j2n_UpdateScore",{score:t.score,target_after_IncomeGold:t.target_after_IncomeGold},function(t){base.GameApp.isDebug&&egret.log("JS received response:",t)})},e.prototype.updateMoney=function(t){e.nativeBridge.callHandler("j2n_UpdateMoney",{money:t},function(t){console.log("JS received response:",t)})},e.prototype.loginSuccess=function(){base.GameApp.isDebug||e.nativeBridge.callHandler("j2n_LoginSuccess",{data:""},function(t){console.log("JS received response:",t)})},e.prototype.destroy=function(){},e}(egret.Sprite);t.NativeModel=e,__reflect(e.prototype,"gamewidget.NativeModel")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.net=new egret.Bitmap,this.net.texture=RES.getRes("net_png"),this.net.anchorOffsetX=this.net.width/2,this.net.anchorOffsetY=this.net.height/2},e.prototype.open=function(t,e,i){this.net.x=t,this.net.y=e,this.net.scaleX=this.net.scaleY=.1,i.addChild(this.net),egret.Tween.get(this.net).to({scaleX:1,scaleY:1},100).wait(200).to({scaleX:.1,scaleY:0},100).call(function(){})},e}(egret.Sprite);t.NetView=e,__reflect(e.prototype,"gamewidget.NetView")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i.initUi(e),i.height=e,i}return __extends(e,t),e.prototype.initUi=function(t){var e=RES.getRes("win_bean_m_json"),i=RES.getRes("win_bean_m_png"),n=new egret.MovieClipDataFactory(e,i);this.bean_m=new egret.MovieClip(n.generateMovieClipData("win_bean_m")),this.bean_m.x=30,this.bean_m.y=t-210;var s=1.6;this.bean_m.scaleX=this.bean_m.scaleY=s,this.bean_m.addEventListener(egret.Event.COMPLETE,function(){this.bean_m.gotoAndStop(1),this.removeChild(this.bean_m)},this),this.bean_m_value=new egret.BitmapText,this.bean_m_value.scaleX=this.bean_m_value.scaleY=.7*s,this.bean_m_value.font=RES.getRes("win_num_fnt"),this.bean_m_value.text="0",this.bean_m_value.width=200,this.bean_m_value.height=50,this.bean_m_value.x=100,this.bean_m_value.y=t-120},e.prototype.showTheBean=function(t){var e=this;if(t>0){this.bean_m.parent&&this.removeChild(this.bean_m),this.bean_m.gotoAndStop(1),this.addChild(this.bean_m),this.bean_m.gotoAndPlay(0,3),this.addChildAt(this.bean_m_value,this.numChildren-1);var i=this.bean_m_value.y=this.height-120;egret.Tween.removeTweens(this.bean_m_value),this.bean_m_value.text=""+t,egret.Tween.get(this.bean_m_value).to({y:i-30},1e3).call(function(){e.removeChild(e.bean_m_value)})}},e}(egret.Sprite);t.NumberView=e,__reflect(e.prototype,"gamewidget.NumberView")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.deviceType=-2,t.gameParam={port:60001,ip:"wss://gamefish.qiyuexiu.com",userId:233669728,token:"5f97df0f6d1623b91bf0bdcc52ad5a66",chatRoomID:40009,gameId:31,gameRoomID:31,DeviceType:1,sub_channel:"5-2",MobileCode:"0705881d0f2cf29f83ee2aa422dc2e7d"},t.isInGameRoom=!0,t.myUser=user.UserModel.getInstance(),t}return __extends(i,e),i.prototype.init=function(){this.socketevent=new SocketEvent(SocketEvent.SOCKET),this.nativieModel=new t.NativeModel,this.nativieModel.addEventListener(NativeEvent.NATIVE,this.getNativeAction,this),this.nativieModel.init()},i.prototype.getNativeAction=function(t){egret.log("收到native消息"),this.testCreateSocket(t.strdata)},i.prototype.registerFunc=function(t){switch(t=t.data,t.key){}},i.prototype.destroy=function(){},i.prototype.exitLiveRoom=function(t){this.requireCloseSocket()},i.prototype.exitGame=function(t){this.destorySocket(),this.connectTimer.killTimer()},i.prototype.createWebSocket=function(t){this.createSocket()},i.prototype.testCreateSocket=function(t){egret.log(t+""),this.parseTheData(t)},i.prototype.createSocket=function(){null==this.mySocket,this.mySocket=new egret.WebSocket,this.mySocket.type=egret.WebSocket.TYPE_STRING,this.mySocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.mySocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.mySocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.mySocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.connectToServer(),this.buffer=new egret.ByteArray},i.prototype.getWebSocket=function(){return this.mySocket},i.prototype.destorySocket=function(){egret.log("销毁socket！"),null!=this.mySocket&&(this.mySocket.close(),this.connectTimer.killTimer(),this.mySocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.mySocket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.mySocket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.mySocket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.mySocket=null,this.buffer=null)},i.prototype.connectToServer=function(){egret.log("连接中..."),t.Toast.launch("连接中...");var e=!0;if(e)try{var i=parseInt(this.gameParam.port);this.mySocket.connectByUrl(this.gameParam.ip+":"+i),egret.log(this.gameParam.sub_channel)}catch(n){egret.log("连接出错"+n),t.Toast.launch("连接出错"),t.NativeModel.nativeBridge.callHandler("j2n_exception",{data:"连接出错"+n},function(t){egret.log("j2n_exception")})}else this.mySocket.connectByUrl(this.gameParam.ip+":"+this.gameParam.port)},i.prototype.onSocketOpen=function(){egret.log("服务器连接成功"),t.Toast.launch("服务器连接成功"),this.connectTimer=new t.ConnectTimer,this.connectTimer.createTimer(),this.connetFailedTimes=0,this.connectTimer.setLastTime(null),this.login()},i.prototype.login=function(){egret.log("正在登录..."),t.Toast.launch("正在登录..."),this.sendLogin({userId:parseInt(this.gameParam.userId),token:this.gameParam.token,gameRoomID:parseInt(this.gameParam.gameRoomID),chatRoomID:parseInt(this.gameParam.chatRoomID),DeviceType:parseInt(this.gameParam.DeviceType),sub_channel:this.gameParam.sub_channel,MobileCode:this.gameParam.MobileCode})},i.prototype.closeSocket=function(){egret.log("主动断开连接"),this.mySocket.close(),this.connectTimer.killTimer()},i.prototype.onSocketClose=function(){var t=this;egret.log("连接断开");var e=egret.setTimeout(function(){t.connectToServer(),egret.clearTimeout(e)},this,2e3);this.connetFailedTimes++},i.prototype.reConnectToServer=function(){egret.log("开始重连服务端"),this.destorySocket(),this.createSocket()},i.prototype.onSocketError=function(t){egret.log("连接异常"),egret.log("error:: type: "+t.type),egret.log("error:: data: "+t.data)},i.prototype.sendData=function(t){t=JSON.stringify(t),this.mySocket.connected&&(this.mySocket.writeUTF(t),this.mySocket.flush())},i.prototype.onTimerHeartBeat=function(){this.sendHeartBeat()},i.prototype.sendLogin=function(t){t.Msg=i.LOGIN_SERVER,this.sendData(t)},i.prototype.requireCloseSocket=function(){egret.log("2");var t={};t.Msg=i.CLOSE_SOCKET,t.userId=parseInt(this.gameParam.userId),this.sendData(t),egret.log("断线请求已发送，断线用户ID："+t.userId),egret.log("requireCloseSocket: /"+t.Msg+"/ at "+(new Date).toTimeString())},i.prototype.switchState=function(t,e,n){0==t?n||(this.isInGameRoom=!1):1==t&&(this.isInGameRoom=!0);var s={};s.Msg=i.CHANGE_STATE,s.userId=parseInt(this.gameParam.userId),s.type=t,s._gold=e,this.sendData(s)},i.prototype.catchFish=function(t){this.isInGameRoom&&(t.Msg=i.CATCH_FISHS,t.userId=parseInt(this.gameParam.userId),this.sendData(t))},i.prototype.sendHeartBeat=function(){var t={};t.Msg=i.HEART_BEATS,this.sendData(t)},i.prototype.parseTheData=function(t){this.gameParam=JSON.parse(t+""),this.createSocket()},i.prototype.onReceiveMessage=function(e){var n=this.mySocket.readUTF(),s=JSON.parse(n);switch(s.Msg){case i.LOGIN_SERVER:t.Toast.launch("登录成功"),egret.log("登录成功"+n),this.socketevent.strjson=n,this.dispatchEvent(this.socketevent),this.HeartIntvel&&egret.clearInterval(this.HeartIntvel),this.HeartIntvel=egret.setInterval(this.onTimerHeartBeat,this,6e3);break;case i.CLOSE_SOCKET:console.log("收到断线请求返回，断线用户ID："+s.userId),this.destorySocket();break;case i.PRODUCE_FISH:this.socketevent.strjson=n,this.dispatchEvent(this.socketevent);break;case i.CATCH_FISHS:this.socketevent.strjson=n,this.dispatchEvent(this.socketevent);break;case i.CHANGE_STATE:this.socketevent.strjson=n,this.dispatchEvent(this.socketevent)}},i.LOGIN_SERVER=30001,i.CLOSE_SOCKET=20004,i.HEART_BEATS=22,i.CHANGE_STATE=2e4,i.ENTER_ROOM_RES=20001,i.PRODUCE_FISH=20002,i.CATCH_FISHS=20003,i}(egret.Sprite);t.ServerModel=e,__reflect(e.prototype,"gamewidget.ServerModel")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.isPlaySound=!0,e}return __extends(e,t),e.prototype.playSound=function(t){if(this.isPlaySound){var e=RES.getRes(t.name+"_mp3");e.play(0,1)}},e.prototype.turnSound=function(t){this.isPlaySound=t},e}(base.baseclass);t.SoundModule=e,__reflect(e.prototype,"gamewidget.SoundModule")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.isCheck=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.create()},e.prototype.create=function(){this.btOn=new egret.Bitmap,this.btOn.texture=RES.getRes("sound_on_png"),this.btOn.x=0,this.btOn.y=0,this.addChild(this.btOn),this.btOff=new egret.Bitmap,this.btOff.texture=RES.getRes("sound_off_png"),this.btOff.x=0,this.btOff.y=0,this.addChild(this.btOff),this.btOff.visible=!1},e.prototype.status=function(t){"on"==t?(this.btOn.visible=!0,this.btOff.visible=!1):"off"==t&&(this.btOn.visible=!1,this.btOff.visible=!0),this.isCheck=!this.isCheck},e}(egret.Sprite);t.SoundSwitch=e,__reflect(e.prototype,"gamewidget.SoundSwitch")}(gamewidget||(gamewidget={}));var gamewidget;!function(t){var e=function(t){function e(i,n,s,o){var a=t.call(this)||this;o&&o.fadeOut(),a.preToast=o;var r=new egret.Bitmap(e._txtrToastBg);a.addChild(r);var h=new eui.Label;return h.multiline=!0,h.size=25,h.bold=!0,h.textColor=16775664,h.stroke=1,h.strokeColor=5451011,h.text=i,h.fontFamily="微软雅黑",h.textAlign=egret.HorizontalAlign.CENTER,h.width=r.$getWidth(),h.y=a.$getHeight()/2,a.addChild(h),a.x=n/2-a.$getWidth()/2,a.y=s/2-a.$getHeight()/2,a.alpha=0,egret.Tween.get(a).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){a.parent&&a.parent.removeChild(a)}),a}return __extends(e,t),e.init=function(t,e){this._cont=t,this._txtrToastBg=e},e.launch=function(t){if(this._cont){var i=new e(t,this._cont.stage.stageWidth,this._cont.stage.stageHeight,this._lastToast);this._cont.addChild(i),this._lastToast=i}},e.prototype.fadeOut=function(){var t=this;this.preToast&&this.preToast.fadeOut(),egret.Tween.get(this).to({y:this.y-30},80,egret.Ease.quintIn).to({y:this.y-60},1e3,egret.Ease.quintIn).call(function(){t.parent&&t.parent.removeChild(t)})},e}(egret.DisplayObjectContainer);t.Toast=e,__reflect(e.prototype,"gamewidget.Toast")}(gamewidget||(gamewidget={}));var user;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.userId=233669728,e.token="5f97df0f6d1623b91bf0bdcc52ad5a66",e}return __extends(e,t),e.prototype.registerFunc=function(t){switch(t=t.data,t.key){}},e.prototype.destroy=function(){},e}(base.baseclass);t.UserModel=e,__reflect(e.prototype,"user.UserModel")}(user||(user={}));